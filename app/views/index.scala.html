@(message: String)(implicit request: RequestHeader)

@import helper._

@main("Websocket test") {

	<h1 id="title">Channel tester</h1>

    <div>
        <span>Channel name:</span>
        <input id="channelName" type="text" value="test"/>
        <button id="connectChannel">Connect</button>
    </div> 
    <div>
        <span>Event name</span>
        <input id="eventName" type="text" value="testEvent"/>
        <span>Event params</span>
        <input id="eventParams" type="text" value=""/>
        <button id="sendEvent">Send</button>
    </div>
    <div>
        <span>Target device</span>
        <input id="cmdDeviceName" type="text" value="deviceD"/>
        <span>Command name</span>
        <input id="cmdName" type="text" value="testCommand"/>
        <span>Event params</span>
        <input id="cmdParams" type="text" value=""/>
        <button id="sendCmd">Send</button>
    </div>
    <div>
        <button id="getDevices">Get connected devices</button>
    </div>
    
    <div id="chatLog" class="chatLog"></div>
 
 	<script>
 	
    var deviceName = "device" + (Math.floor(Math.random() * 100));
    $("#title").text(deviceName);

    var connection = null;

    $('#connectChannel').click(function(){
    	var channelName = $("#channelName").val()
    	connection = createConnection(channelName, deviceName, "pass");
    });

    function createConnection(channelName, device, pass){
        var url = "@routes.Application.ws.webSocketURL()";
        var connection = channelConnect(url, channelName, device, pass);
      
        connection.onConnected = function(){
          message("Connected");
        }

        connection.onError = function(reason){
          message("Error: " + reason);
        }
      
        connection.onEvent = function(id, content){
            if(id == "picture"){
                messageImage(chatLog, content);
            } else {
                message("Event received. Name: " + id + " params:" + content);
            }               
        }
        
        connection.onMessage = function(from, id, params){
            message("Message received from: " + from + " name: " + id + " params:" + params);
        }
        
        connection.onDevicesEvent = function(devices){
        	message("Connected devices:");
        	for(var i in devices){
        		message(devices[i]);
        	}
        }
   
        return connection;
      }

    
      function message(msg){
          $('#chatLog').append(msg+'</p>');
      }
	 	
      $('#sendEvent').click(function(){
    	  var eventName = $("#eventName").val();
    	  var eventParams = $("#eventParams").val();
    	  connection.sendToChannel(eventName, eventParams);
      });
      $('#sendCmd').click(function(){
    	  var targetDevice = $("#cmdDeviceName").val();
    	  var command = $("#cmdName").val();
    	  var params = $("#cmdParams").val();
          connection.sendToDevice(targetDevice, command, params);
      });
      $('#getDevices').click(function(){
          connection.getDevices();
      });
      
      
      $('#disconnectChannel').click(function(){
      });
 	
 	</script>   
}