@(message: String)(implicit request: RequestHeader)

@import helper._

@main("Websocket test") {

	<h1 id="title">Channel tester</h1>

    <div class="panel">
        <span class="panelHeader">Connection:</span>
        <span >Channel name:</span>
        <input id="channelName" type="text" value="test"/>
        <button id="connectChannel">Connect</button>
    </div> 
    <div class="panel">
        <span class="panelHeader">Get property:</span>
        <span>Device</span>
        <input id="deviceName1" type="text" value=""/>
        <span>property</span>
        <input id="propertyName1" type="text" value="level"/>
        <button id="getPropertyBtn">Send</button>
    </div>
    <div class="panel">
        <span class="panelHeader">Set property:</span>
        <span>Target device</span>
        <input id="deviceName2" type="text" value=""/>
        <span>Property name</span>
        <input id="propertyName2" type="text" value="level"/>
        <span>Event params</span>
        <input id="propertyValue2" type="text" value=""/>
        <button id="setPropertyBtn">Send</button>
    </div>
    <div class="panel">
        <div>Change property temperature to 12. <button id="changePropertyBtn1">Change property</button></div>
    </div>
    <div class="panel">
        <span class="panelHeader">Channel info:</span>
        <button id="getDevices">Get connected devices</button>
    </div>
    
    <div class="panel">
      <h4>Event log</h4>
      <div id="chatLog" class="chatLog"></div>
    </div>
 
 	<script>
 	
    var deviceName = "device" + (Math.floor(Math.random() * 100));
    $("#title").text(deviceName);

    var connection = null;

    $('#connectChannel').click(function(){
    	var channelName = $("#channelName").val()
    	connection = createConnection(channelName, deviceName, "pass");
    });

    function createConnection(channelName, device, pass){
        var url = "@routes.Application.ws.webSocketURL()";
        var connection = channelConnect(url, channelName, device, pass);
      
        connection.onConnected = function(){
          message("Connected");
        }

        connection.onError = function(reason){
          message("Error: " + reason);
        }
      
        connection.onDeviceJoinedChannel = function(deviceName){
            message("Device " + deviceName + " joined channel.");
        }
        
        connection.onDeviceLeftChannel = function(deviceName){
            message("Device " + deviceName + " left channel.");
        }
        
        connection.onSetProperty = function(property, value){
            message("Set property <b>" + property + "</b> to value: <b>" + value + "</b>");
        }
        
        connection.onPropertyChanged = function(device, property, value){
            message("Property <b>" + property + "</b> on device <b>" + device + "</b> changed to value: <b>" + value + "</b>");
        }
        
        connection.onGetProperty = function(device, property){
            message("Device <b>" + device + "</b> asked for property <b>" + property + "</b>.");
            connection.sendPropertyValue(device, "level", "13");
        }
        
        connection.onPropertyValue = function(device, property, value){
            message(device + "." + property + " = <b>" + value + "</b>.");
        }

        connection.onDevicesEvent = function(devices){
        	message("Connected devices:");
        	for(var i in devices){
        		message(devices[i]);
        	}
        }
   
        return connection;
      }

    
      function message(msg){
          $('#chatLog').append(msg+'</p>');
      }
	 	
      $("#getPropertyBtn").click(function(event) {
    	  var device = $("#deviceName1").val();
    	  var property = $("#propertyName1").val();
    	  connection.getDeviceProperty(device, property);
      });
      
      $("#setPropertyBtn").click(function(event) {
          var device = $("#deviceName2").val();
          var property = $("#propertyName2").val();
          var value = $("#propertyValue2").val();
          connection.setDeviceProperty(device, property, value);
      });
      
      $("#changePropertyBtn1").click(function(event) {
          connection.notifyPropertyChanged("temperature", "12");
      });

      $('#getDevices').click(function(){
          connection.getDevices();
      });
      
      
      $('#disconnectChannel').click(function(){
      });
 	
 	</script>   
}